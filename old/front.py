# -*- coding: utf-8 -*-
"""front.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1FWJRKEqg2bviqI2xYX0TeH3K9iorJsAp
"""

# ===========================================
# Colabç”¨ ãƒ•ãƒ­ãƒ³ãƒˆUIï¼ˆæ ã®ã¿ãƒ»ãƒ€ãƒŸãƒ¼é€²æ—ã¤ãï¼‰
# ç”»åƒã§ç¤ºã•ã‚ŒãŸãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ Gradio ã§å†ç¾
# ===========================================


import gradio as gr
import pandas as pd
import time

# ------- è¦‹ãŸç›®ï¼ˆCSSï¼‰ -------
CSS = """
.gradio-container {max-width: 1280px !important;}
.topbar {
  padding: 10px 14px; font-weight: 700; font-size: 1.05rem;
  border-radius: 12px; background: rgba(148,163,184,.12); border: 1px solid rgba(148,163,184,.35);
}
.card { border: 2px dashed #94a3b8; border-radius: 14px; padding: 12px; background: rgba(148,163,184,.06); }
.card .title { font-weight: 700; margin: 4px 0 10px; }
.placeholder { min-height: 120px; display:flex; align-items:center; justify-content:center; color:#64748b; }
.bigbox { min-height: 260px; }
.matrix { min-height: 220px; }
.badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:.85rem; background:#e2e8f0; color:#475569; }
"""

# ------- ãƒ€ãƒŸãƒ¼è¡¨ç¤ºï¼ˆAIãŒå‹•ã„ã¦ã„ã‚‹é¢¨ï¼‰ -------
def simulate():
    steps = [
        "KPIå€™è£œã‚’æŠ½å‡ºä¸­â€¦",
        "å› æœã‚°ãƒ©ãƒ•ã®ç´ æ¡ˆã‚’æ§‹ç¯‰ä¸­â€¦",
        "çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­â€¦",
        "æ•°ç†æœ€é©åŒ–ã®è¨­å®šã‚’çµ„ã¿ç«‹ã¦ä¸­â€¦",
        "å®Œäº†ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰"
    ]
    for i, msg in enumerate(steps, 1):
        pill = f"ğŸ§  {msg} ({i}/{len(steps)})"
        yield pill, pill, pill, pill
        time.sleep(0.6)

def reset():
    return "â€”", "â€”", "â€”", "â€”"

# ------- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ -------
policies = [f"æ”¿ç­– {c}" for c in list("ABCD")]
kpis     = [f"KPI{i}" for i in range(1,5)]
matrix_df = pd.DataFrame("", index=policies, columns=kpis)

# More realistic dummy data
kpi_data = {
    "KPIå": [
        "åŒ»å¸«ã®å¹³å‡åŠ´åƒæ™‚é–“",
        "åŒ»å¸«æ•°",
        "ç¤¾ä¼šä¿éšœè²»",
        "åœ°æ–¹/æ±äº¬ã®åŒ»å¸«æ¯”",
        "ç—…é™¢æº€è¶³åº¦",
        "åŒ»å¸«ã®é›¢è·ç‡",
        "åˆæœŸç ”ä¿®åŒ»å¸«æ•°",
        "æ²»ç™‚ã«ã‚ˆã‚‹çµŒæ¸ˆæå¤±ã®å›é¿"
    ],
    "å®šç¾©ï¼ˆä»»æ„ï¼‰": [
        "åŒ»å¸«1äººã‚ãŸã‚Šé€±å¹³å‡ã®å°±åŠ´æ™‚é–“ï¼ˆè‡¨åºŠãƒ»éè‡¨åºŠå«ã‚€ï¼‰",
        "åœ°åŸŸå†…ã®å¸¸å‹¤æ›ç®—ã®åŒ»å¸«æ•°",
        "ä¸€èˆ¬ä¼šè¨ˆæ­³å‡ºã«å ã‚ã‚‹ç¤¾ä¼šä¿éšœé–¢ä¿‚è²»",
        "äººå£1ä¸‡å¯¾åŒ»å¸«æ•°ï¼ˆåœ°æ–¹ï¼‰/ åŒï¼ˆæ±äº¬ï¼‰ã®æ¯”",
        "æ‚£è€…ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ5æ®µéšè©•ä¾¡ã®å¹³å‡",
        "å¹´å†…é›¢è·åŒ»å¸«æ•° / åœ¨ç±åŒ»å¸«æ•°",
        "åœ°åŸŸå†…ã®åˆæœŸç ”ä¿®åŒ»ã®äººæ•°",
        "ç–¾æ‚£è² æ‹…ãƒ»ç”Ÿç”£æ€§æå¤±ã®å›é¿é¡ã®æ¨è¨ˆ"
    ],
    "å˜ä½": [
        "æ™‚é–“/é€±",
        "äºº",
        "å…†å††/å¹´",
        "æ¯”",
        "ç‚¹ï¼ˆ1â€“5ï¼‰",
        "%",
        "äºº",
        "å„„å††/å¹´"
    ],
    "å‡ºå…¸/æ ¹æ‹ ": [
        "å‹¤å‹™å®Ÿæ…‹èª¿æŸ»ç­‰",
        "åŒ»å¸«ãƒ»æ­¯ç§‘åŒ»å¸«ãƒ»è–¬å‰¤å¸«çµ±è¨ˆ",
        "è²¡æ”¿è³‡æ–™",
        "äººå£å‹•æ…‹/åŒ»å¸«çµ±è¨ˆ",
        "æ‚£è€…æº€è¶³åº¦èª¿æŸ»",
        "äººäº‹ãƒ»å±Šå‡ºæƒ…å ±",
        "è‡¨åºŠç ”ä¿®ãƒãƒƒãƒãƒ³ã‚°",
        "æ¨è¨ˆãƒ¢ãƒ‡ãƒ«"
    ]
}

kpi_df = pd.DataFrame(kpi_data)

empty_table = pd.DataFrame(kpi_data)


# åŒ»ç™‚KPIå‘ã‘ãƒ€ãƒŸãƒ¼çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆ3åˆ—æ§‹æˆï¼‰
# ---- åŒ»ç™‚ç”¨ã®å…ƒã«ãªã‚‹çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆKPIå°å‡ºã«ä½¿ã†å®¢è¦³æŒ‡æ¨™ï¼‰ ----
stats_data = {
    "æŒ‡æ¨™": [
        "é€±å¹³å‡åŠ´åƒæ™‚é–“ï¼ˆåŒ»å¸«, æ™‚é–“/é€±ï¼‰",        # â†’ KPI: åŒ»å¸«ã®å¹³å‡åŠ´åƒæ™‚é–“
        "åŒ»å¸«æ•°ï¼ˆå¸¸å‹¤æ›ç®—FTE, äººï¼‰",               # â†’ KPI: åŒ»å¸«æ•°
        "ç¤¾ä¼šä¿éšœé–¢ä¿‚è²»ï¼ˆå…†å††/å¹´ï¼‰",                # â†’ KPI: ç¤¾ä¼šä¿éšœè²»
        "äººå£10ä¸‡å¯¾åŒ»å¸«æ•°ï¼ˆåœ°æ–¹, äººï¼‰",             # â†’ KPI: åœ°æ–¹/æ±äº¬ã®åŒ»å¸«æ¯”ï¼ˆåœ°æ–¹å´ï¼‰
        "äººå£10ä¸‡å¯¾åŒ»å¸«æ•°ï¼ˆæ±äº¬, äººï¼‰",             # â†’ KPI: åœ°æ–¹/æ±äº¬ã®åŒ»å¸«æ¯”ï¼ˆæ±äº¬å´ï¼‰
        "å…¥é™¢æ‚£è€…æº€è¶³åº¦å¹³å‡ï¼ˆ1â€“5ç‚¹ï¼‰",             # â†’ KPI: ç—…é™¢æº€è¶³åº¦
        "æœŸé¦–åœ¨ç±åŒ»å¸«æ•°ï¼ˆäººï¼‰",                     # â†’ KPI: åŒ»å¸«ã®é›¢è·ç‡ åˆ†æ¯
        "å¹´å†…é›¢è·åŒ»å¸«æ•°ï¼ˆäººï¼‰",                     # â†’ KPI: åŒ»å¸«ã®é›¢è·ç‡ åˆ†å­
        "åˆæœŸç ”ä¿®åŒ»æ¡ç”¨æ•°ï¼ˆäººï¼‰",                   # â†’ KPI: åˆæœŸç ”ä¿®åŒ»å¸«æ•°
        "ä¸»è¦ç–¾æ‚£ã®æ‚£è€…æ•°ï¼ˆäººï¼‰",                    # â†’ å›é¿æå¤±ã®åŸºç¤
        "å¹³å‡è³ƒé‡‘ï¼ˆæ—¥é¡, å††ï¼‰",                      # â†’ å›é¿æå¤±ã®åŸºç¤
        "1äººã‚ãŸã‚Šå°±åŠ´æå¤±æ—¥æ•°ï¼ˆæ²»ç™‚å‰, æ—¥ï¼‰",       # â†’ å›é¿æå¤±ã®åŸºç¤
        "1äººã‚ãŸã‚Šå°±åŠ´æå¤±æ—¥æ•°ï¼ˆæ²»ç™‚å¾Œ, æ—¥ï¼‰",       # â†’ å›é¿æå¤±ã®åŸºç¤
        "æ¨å®šå›é¿æå¤±é¡ï¼ˆå„„å††/å¹´ï¼‰"                 # = (æ²»ç™‚å‰-æ²»ç™‚å¾Œ)*å¹³å‡è³ƒé‡‘*æ‚£è€…æ•° / 1e8
    ],
    "å¹´": [
        2022, 2022, 2022, 2022, 2022, 2022,
        2022, 2022, 2022, 2022, 2022, 2022,
        2022, 2022
    ],
    "å€¤": [
        52.0,          # é€±å¹³å‡åŠ´åƒæ™‚é–“ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        340000,        # åŒ»å¸«FTEæ•°ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        130.5,         # å…†å††/å¹´ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        210.0,         # äºº/10ä¸‡ï¼ˆåœ°æ–¹, ãƒ€ãƒŸãƒ¼ï¼‰
        320.0,         # äºº/10ä¸‡ï¼ˆæ±äº¬, ãƒ€ãƒŸãƒ¼ï¼‰
        4.1,           # æº€è¶³åº¦ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        340000,        # æœŸé¦–åœ¨ç±ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        12000,         # é›¢è·æ•°ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        9000,          # åˆæœŸç ”ä¿®åŒ»æ¡ç”¨ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        2000000,       # ä¸»è¦ç–¾æ‚£æ‚£è€…æ•°ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        16000,         # å††/æ—¥ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
        10.0,          # æ—¥ï¼ˆæ²»ç™‚å‰, ãƒ€ãƒŸãƒ¼ï¼‰
        7.0,           # æ—¥ï¼ˆæ²»ç™‚å¾Œ, ãƒ€ãƒŸãƒ¼ï¼‰
        960.0          # å„„å††/å¹´ï¼ˆä¾‹: (10-7)*16000*2,000,000 / 1e8 = 960ï¼‰
    ],
    "å‡ºå…¸": [
        "å‹¤å‹™å®Ÿæ…‹èª¿æŸ»ç­‰ï¼ˆä¾‹ï¼‰",
        "åŒ»å¸«ãƒ»æ­¯ç§‘åŒ»å¸«ãƒ»è–¬å‰¤å¸«çµ±è¨ˆï¼ˆä¾‹ï¼‰",
        "ç¤¾ä¼šä¿éšœé–¢ä¿‚è²»ãƒ»å›½æ°‘åŒ»ç™‚è²»ï¼ˆä¾‹ï¼‰",
        "åœ°åŸŸåŒ»ç™‚çµ±è¨ˆ/åŒ»å¸«ååœ¨æŒ‡æ¨™ï¼ˆä¾‹ï¼‰",
        "åœ°åŸŸåŒ»ç™‚çµ±è¨ˆ/åŒ»å¸«ååœ¨æŒ‡æ¨™ï¼ˆä¾‹ï¼‰",
        "æ‚£è€…ä½“é¨“ãƒ»æº€è¶³åº¦èª¿æŸ»ï¼ˆä¾‹ï¼‰",
        "äººäº‹ãƒ»å±Šå‡ºæƒ…å ±ï¼ˆä¾‹ï¼‰",
        "äººäº‹ãƒ»å±Šå‡ºæƒ…å ±ï¼ˆä¾‹ï¼‰",
        "è‡¨åºŠç ”ä¿®ãƒãƒƒãƒãƒ³ã‚°ï¼ˆä¾‹ï¼‰",
        "æ‚£è€…èª¿æŸ»ãƒ»ç–¾ç—…çµ±è¨ˆï¼ˆä¾‹ï¼‰",
        "è³ƒé‡‘æ§‹é€ åŸºæœ¬çµ±è¨ˆèª¿æŸ»ï¼ˆä¾‹ï¼‰",
        "COI/ç–«å­¦æ¨è¨ˆï¼ˆä¾‹ï¼‰",
        "COI/ç–«å­¦æ¨è¨ˆï¼ˆä¾‹ï¼‰",
        "ä¸Šè¨˜ã®åˆæˆæ¨è¨ˆï¼ˆä¾‹ï¼‰"
    ]
}
stats_df = pd.DataFrame(stats_data)



opt_data = {
    "æ”¿ç­–çµ„åˆã›": ["æ”¿ç­–Aã®ã¿", "æ”¿ç­–Bã®ã¿", "æ”¿ç­–A + C", "æ”¿ç­–B + D", "æ”¿ç­–A + B + C + D", "æ”¿ç­–Cã®ã¿"],
    "ç›®çš„é–¢æ•°å€¤": [85, 78, 92, 88, 70, 65],
    "åˆ¶ç´„ãƒ¡ãƒ¢": ["ã‚³ã‚¹ãƒˆä¸Šé™å†…", "ã‚³ã‚¹ãƒˆä¸Šé™å†…", "ã‚³ã‚¹ãƒˆä¸Šé™è¶…éï¼ˆè¦æ¤œè¨ï¼‰", "æ™‚é–“åˆ¶ç´„ã‚ã‚Š", "ãƒªã‚½ãƒ¼ã‚¹ä¸è¶³", "ç‰¹ã«åˆ¶ç´„ãªã—"]
}
opt_df = pd.DataFrame(opt_data)


# ------- UI æ§‹ç¯‰ -------
with gr.Blocks(css=CSS, title="æ”¿ç­–è©•ä¾¡UIï¼ˆæ ã®ã¿ï¼‰") as demo:
    gr.HTML('<div class="topbar">æ”¿ç­–è©•ä¾¡ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆæ ã®ã¿ / ãƒ€ãƒŸãƒ¼æŒ™å‹•ï¼‰</div>')

    with gr.Row():
        # ===== å·¦ã‚«ãƒ©ãƒ  =====
        with gr.Column(scale=7, min_width=640):
            # æ”¿ç­–ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰
            with gr.Group(elem_classes="card"):
                gr.Markdown("### æ”¿ç­–ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰", elem_classes="title")
                policy_txt = gr.Textbox(placeholder="ã“ã“ã«æ”¿ç­–ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘", lines=6)

            # PDF ã¨ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒˆï¼ˆåˆ¥æ ï¼‰
            with gr.Row():
                with gr.Column():
                    with gr.Group(elem_classes="card"):
                        gr.Markdown("### PDF è³‡æ–™", elem_classes="title")
                        pdf_upl = gr.File(label="PDFã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆè¤‡æ•°å¯ï¼‰",
                                          file_count="multiple", file_types=[".pdf"])
                with gr.Column():
                    with gr.Group(elem_classes="card"):
                        gr.Markdown("### ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒˆ", elem_classes="title")
                        rev_upl = gr.File(label="ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒˆï¼ˆCSV/Excel/PDF ãªã©ï¼‰",
                                          file_count="multiple",
                                          file_types=[".csv", ".xlsx", ".xls", ".pdf"])

            # KPIã®ä¸€è¦§ï¼ˆæ ã ã‘ï¼‰
            with gr.Group(elem_classes="card"):
                gr.Markdown("### KPI ã®ä¸€è¦§", elem_classes="title")
                kpi_status = gr.Markdown("â€”", elem_classes="badge")
                kpi_table  = gr.Dataframe(value=empty_table, interactive=False)

            # æ•°å€¤çš„ãªäºˆæ¸¬ï¼ˆæ”¿ç­– Ã— KPI ã®ãƒãƒˆãƒªã‚¯ã‚¹ãƒ»æ ã ã‘ï¼‰
            with gr.Group(elem_classes="card"):
                gr.Markdown("### æ•°å€¤çš„ãªäºˆæ¸¬ï¼ˆæ”¿ç­– Ã— KPIï¼‰", elem_classes="title")
                gr.Markdown("ï¼ˆè¡Œï¼šæ”¿ç­–A/B/Câ€¦ã€€åˆ—ï¼šKPI1/2/3â€¦ã€€â€” å€¤ã¯ç©ºã®ã¾ã¾ï¼‰", elem_classes="badge")
                mat = gr.Dataframe(value=matrix_df, interactive=False, elem_classes="matrix")

            # éæ•°å€¤çš„ãªäºˆæ¸¬ï¼ˆè«–ç‚¹ãƒªã‚¹ãƒˆã®ç©ºé–“ï¼‰
            with gr.Group(elem_classes="card"):
                gr.Markdown("### éæ•°å€¤çš„ãªäºˆæ¸¬ï¼ˆè«–ç‚¹ã®ä¸€è¦§ï¼‰", elem_classes="title")
                nonnum = gr.Textbox(
                    value="ãƒ»ï¼ˆã“ã“ã«è«–ç‚¹ãŒä¸¦ã¶ï¼‰\nãƒ»ï¼ˆä¾‹ï¼šåˆ¶åº¦è¨­è¨ˆä¸Šã®ç•™æ„ç‚¹ã€å€«ç†ãƒ»å…¬å¹³æ€§ã€å°å…¥æ™‚ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ ãªã©ï¼‰",
                    lines=6, interactive=False
                )

        # ===== å³ã‚«ãƒ©ãƒ  =====
        with gr.Column(scale=5, min_width=420):
            # å› æœã‚°ãƒ©ãƒ•ï¼ˆç®±ã ã‘ï¼‰
            with gr.Group(elem_classes="card"):
                gr.Markdown("### å› æœã‚°ãƒ©ãƒ•", elem_classes="title")
                cg_status = gr.Markdown("â€”", elem_classes="badge")
                gr.HTML('<div class="placeholder bigbox">ï¼ˆã“ã“ã«å› æœã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚Œã‚‹æƒ³å®šï¼‰</div>')

            # å…ƒã«ãªã‚‹çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆæ ï¼‰
            with gr.Group(elem_classes="card"):
                gr.Markdown("### å…ƒã«ãªã‚‹çµ±è¨ˆãƒ‡ãƒ¼ã‚¿", elem_classes="title")
                data_status = gr.Markdown("â€”", elem_classes="badge")
                stats_tbl = gr.Dataframe(value=stats_df, interactive=False)

            # æ•°ç†æœ€é©åŒ–ã—ãŸçµæœï¼ˆæ ï¼‰
            with gr.Group(elem_classes="card"):
                gr.Markdown("### æ•°ç†æœ€é©åŒ–ã—ãŸçµæœ", elem_classes="title")
                opt_status = gr.Markdown("â€”", elem_classes="badge")
                opt_tbl = gr.Dataframe(value=opt_df, interactive=False)

    # ä¸‹éƒ¨ï¼šãƒ€ãƒŸãƒ¼æ“ä½œãƒœã‚¿ãƒ³
    with gr.Row():
        run_btn = gr.Button("AIè§£æï¼ˆãƒ€ãƒŸãƒ¼ï¼‰ã‚’è¡¨ç¤º", variant="primary")
        reset_btn = gr.Button("è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ")

    # ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
    run_btn.click(fn=simulate, outputs=[kpi_status, cg_status, data_status, opt_status])
    reset_btn.click(fn=reset, outputs=[kpi_status, cg_status, data_status, opt_status])

demo.launch(share=True)

